## CodeBook
Last updated on `r date()` by Sarah Huang

***

### A look at the tidy dataset generated by <span style="color:blue">run_analysis.R</span>

***

```{r echo=FALSE}
load(file.path(getwd(), "run_analysis.RData"))
```
```{r}
mergedDataTidy[1:10,]
```

***

Variables  | Description | Value
------------- | ------------- | -------------
subject  | subject identifiers. | 1 - 30
activity  | activity names | `r unique(mergedDataTidy$activity)`
domain | signal obtained in time domain or frequency domain? | `r unique(mergedDataTidy$domain)`
instrument | signal obtained from accelerometer or gyroscope? | `r unique(mergedDataTidy$instrument)`
acceleration | gravitational or body motion components of the signal? | `r unique(mergedDataTidy$acceleration)`
jerk | jerk signal calculated? | `r unique(mergedDataTidy$jerk)`
magnitude | magnitude calculated? | `r unique(mergedDataTidy$magnitude)`
axis | which of the 3-axial measurement? | `r unique(mergedDataTidy$axis)`
statistics | mean or standard deviation calculated? | `r unique(mergedDataTidy$statistics)`
number_of_measurement | count of data points used to calculate each average | see data structure below for examples
average | mean value of each possible feature combination for each subject and each activity | see data structure below for examples

***

##### Data structure
```{r echo=FALSE}
str(mergedDataTidy)
```

***

### Information on the raw dataset

***

Can be found in the raw-data folder "UCI HAR Data". See files *features_info.txt* and *README*.

***

### Transform the original raw data to tidy data

***

#### Before importing the data

***

**Load the packages.**
```{r}
packages <- c("data.table", "reshape2")
sapply(packages, require, character.only = TRUE, quietly = TRUE)
```

***

**Set the working directory**.
```{r}
setwd("C:/Users/Sarah/Documents/Sarah/DataScience_Courses_JHU/GettingAndCleaningData/Project")
```

***

#### Import the raw data

***

```{r eval=FALSE}
url <- "https://d396qusza40orc.cloudfront.net/getdata%2Fprojectfiles%2FUCI%20HAR%20Dataset.zip"
download.file(url, "dataset.zip", mode = "wb")
unzip("dataset.zip")
```

This creates a folder "UCI HAR Dataset" containing all the raw data.

***

#### Read the data files into R objects

***

```{r}
path <- file.path(getwd(), "UCI HAR Dataset")

subjectTrain <- fread(file.path(path, "train", "subject_train.txt"))
trainingSet <- data.table(read.table(file.path(path, "train", "X_train.txt")))
activityTrain <- fread(file.path(path, "train", "y_train.txt"))

subjectTest <- fread(file.path(path, "test", "subject_test.txt"))
testSet <- data.table(read.table(file.path(path, "test", "X_test.txt")))
activityTest <- fread(file.path(path, "test", "y_test.txt"))
```

***

#### Merge the training data and test data to create one dataset

***

```{r}
mergedTrain <- cbind(subjectTrain, activityTrain, trainingSet)
setnames(mergedTrain, 1:2, c("subject", "activity"))

mergedTest <- cbind(subjectTest, activityTest, testSet)
setnames(mergedTest, 1:2, c("subject", "activity"))

mergedData <- rbind(mergedTrain, mergedTest)
```

The dataset structure is shown below.

```{r}
str(mergedData)
```

***

#### Extract measurements on the mean and standard deviation

***

**Read the "features" file**

This file will be used to set the descriptive variable names for the dataset

```{r}
features <- fread(file.path(path, "features.txt"))
setnames(features, 1:2, c("featureNum", "featureName"))
```
```{r}
features
```

***

**Subset the features** by selecting only measurements on the mean and standard deviation

A new column "featureCode" is added to match the variable names in the dataset "mergedData".
The feature vector is now reduced to 66 elements from the original 561.

***

```{r}
features <- features[grepl("mean\\(\\)|std\\(\\)", features$featureName)]
features <- features[, featureCode:=paste0("V", featureNum)]
```
```{r}
features
```

***

**Subset the dataset's feature variables** with only measurements on the mean and standard deviation

***

```{r}
select <- c("subject", "activity", features$featureCode)
mergedData <- mergedData[, select, with = FALSE]
```
```{r}
str(mergedData)
```
***

#### Use descriptive activity names to name the activities

***

**Read the activity file**

```{r}
activityLabels <- fread(file.path(path, "activity_labels.txt"))
setnames(activityLabels, 1:2, c("activity", "activityName"))
```
```{r}
activityLabels
```

**Merge activityLabels with dataset**

```{r}
mergedData <- merge(activityLabels, mergedData, by="activity", all.y=TRUE)
```
```{r}
mergedData
```

**Reorganize and rename the first 3 columns. Remove the one with activity numbers**

```{r}
mergedData <- mergedData[, activity:=subject]
mergedData <- mergedData[, subject := NULL]
setnames(mergedData, 1:2, c("subject", "activity"))
```
```{r}
mergedData
```
***

#### Label the dataset with descriptive variable names

***

```{r}
descriptiveName <- features$featureName
setnames(mergedData, 3:68, descriptiveName)
```
```{r}
names(mergedData)
```

***

#### Further tidy the dataset by using a long form

***

**Melt the 66-feature columns into one column**

```{r}
setkey(mergedData, subject, activity)
mergedData <- melt(mergedData, key(mergedData), variable.name = "feature")
```
```{r}
mergedData
```

**Now the single feature column contains multiple types of measurement and needs to be split into multiple columns.**

```{r}
s <- mergedData$feature
mergedData$domain <- ifelse(grepl("^t", s), "Time", 
                            ifelse(grepl("^f", s), "Freq", NA))
mergedData$instrument <- ifelse(grepl("Acc", s, ignore.case=TRUE), "Accelerometer",
                                ifelse(grepl("Gyro", s, ignore.case=TRUE), "Gyroscope", NA))
mergedData$acceleration <- ifelse(grepl("Body", s, ignore.case=TRUE), "Body",
                                  ifelse(grepl("Gravity", s, ignore.case=TRUE), "Gravity", NA))                        
mergedData$jerk <- ifelse(grepl("Jerk", s, ignore.case=TRUE), "Jerk", NA)
mergedData$magnitude <- ifelse(grepl("Mag", s, ignore.case=TRUE), "Magnitude", NA)                        
mergedData$axis <- ifelse(grepl("X$", s), "X", 
                            ifelse(grepl("Y$", s), "Y", 
                                   ifelse(grepl("Z$", s), "Z", NA)))
mergedData$statistics <- ifelse(grepl("mean", s), "Mean",
                                ifelse(grepl("std", s), "Standard Deviation", NA))
```
```{r}
mergedData
```

**Remove the redundant "feature" column and move the "value" column to the end**

```{r}
mergedData <- mergedData[, feature := NULL]
setcolorder(mergedData, c(1, 2, 4:10, 3))
```
```{r}
mergedData
```

***

#### Create a separate independant tidy data set with the average of each variable for each activity and each subject

***

Take each combination of the parameters specified in "setkey" and compute the average of the measurements and the number of the measurements.

There are a total of 66 combinations of parameters. Each combination is equivalent to one feature variable of the dataset before it was transformed to a long form. 

```{r}
setkey(mergedData, subject, activity, domain, instrument, acceleration, 
       jerk, magnitude, axis, statistics)
mergedDataTidy <- mergedData[, list(number_of_measurement = .N, average = mean(value)), by = key(mergedData)]
```
```{r}
mergedDataTidy
```

***

**Write the new tidy dataset to a text file**

```{r eval=FALSE}
write.table(mergedDataTidy, "tidy_data.txt", row.names = FALSE)
```

***

### *Please see the README file for additional information*

***






